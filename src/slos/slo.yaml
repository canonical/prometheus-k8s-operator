# Since SLOs are defined by users, not by charm developers, this simply serves as an example for
# people to define their own SLOs, and to indicate which, according to the charm developer, are
# important and worth configuring.

version: "prometheus/v1"
service: "prometheus"
labels:
  repo: "canonical/prometheus-k8s-operator"
slos:
  # HTTP API availability - Track non-5xx responses
  - name: "http-availability"
    objective: {objective}
    description: "Availability of the Prometheus HTTP API (non-5xx responses)"
    sli:
      events:
        error_query: sum(rate(prometheus_http_requests_total{code=~"5.."}[{{.window}}]))
        total_query: sum(rate(prometheus_http_requests_total[{{.window}}]))
      alerting:
        name: PrometheusHttpAvailability
        page_alert:
          disable: true
        ticket_alert:
          disable: true

  # Rule evaluation reliability - Track evaluation failures
  - name: "rule-evaluation-success"
    objective: {objective}
    description: "Successful rule evaluations (excluding failures)"
    sli:
      events:
        error_query: sum(rate(prometheus_rule_evaluation_failures_total[{{.window}}]))
        total_query: sum(rate(prometheus_rule_evaluations_total[{{.window}}]))
    alerting:
      name: PrometheusRuleEvaluationSuccess
      page_alert:
        disable: true
      ticket_alert:
        disable: true

  # TSDB compaction reliability - Track compaction failures
  - name: "tsdb-compaction-success"
    objective: {objective}
    description: "Successful TSDB compactions (excluding failures)"
    sli:
      events:
        error_query: sum(rate(prometheus_tsdb_compactions_failed_total[{{.window}}]))
        total_query: sum(rate(prometheus_tsdb_compactions_total[{{.window}}]))
    alerting:
      name: PrometheusTsdbCompactionSuccess
      page_alert:
        disable: true
      ticket_alert:
        disable: true
